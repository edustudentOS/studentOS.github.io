<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exam Ready Notes ‚Äì RGPV 2nd Year</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

<header>
  <h1>Exam Ready Notes ‚Äì RGPV 2nd Year</h1>
</header>


<div id="authBox" style="text-align:center; margin-bottom:16px;">
  <button id="loginBtn">Sign in with Google</button>

  <div id="userInfo" style="display:none; margin-top:8px;">
    <p id="userName" style="font-weight:600;"></p>
    <p id="userEmail" style="font-size:0.85rem; color:#555;"></p>
    <button id="logoutBtn" style="margin-top:8px; background:#ef4444;">Logout</button>
  </div>
</div>


<section id="dashboard" 
  style="display:none; margin:10px auto; max-width:500px; 
         background:#ffffff; padding:16px; border-radius:12px;
         box-shadow:0 4px 12px rgba(0,0,0,0.08);">

  <h3>üëã Welcome, <span id="dashName"></span></h3>

  <p>üéì Semester: <strong id="dashSem">Not selected</strong></p>

  <p>‚≠ê Favourite Subjects:</p>
  <div id="favList" style="display:flex; gap:8px; flex-wrap:wrap;"></div>

  <p style="margin-top:8px;">üì• Last Download: 
     <strong id="lastDownload">None</strong>
  </p>
</section>

<main>

  <section id="notes"></section>


  <form class="filters">

    <!-- Semester -->
    <label for="semester">Semester:</label>
    <select id="semester">
      <option value="">Select Semester</option>
      <option value="1">1st Semester</option>
      <option value="2">2nd Semester</option>
      <option value="3">3rd Semester</option>
      <option value="4">4th Semester</option>
    </select>

    <!-- Show available only -->
    <div style="margin: 8px 0;">
      <input type="checkbox" id="availableOnly">
      <label for="availableOnly">Show Available Only</label>
    </div>

      <!-- Subject -->
    <label for="subject">Subject:</label>
    <select id="subject">
      <option value="">Select Subject</option>
      <option value="">dsa</option>
      <option value="">Discrete Mathematics</option>
      <option value="">EEEs</option>
      <option value="">OOPM</option>
      <option value="">Digital System</option>
    </select>

    <div id="chipContainer" style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
  <!-- Chips yahan JS add karega -->
</div>

        <!-- Material -->
    <label for="material">Material:</label>
    <select id="material">
      <option value="">Select Material</option>
      <option value="notes">Notes</option>
      <option value="pyqs">PYQs</option>
      <option value="syllabus">Syllabus</option>
    </select>

    <button type="button" onclick="openStudyPack()">Open Study Pack</button>

  </form>

  <section class="upload-section">
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfssMV4Ny7hjr5UOaYlmHSr5MAr2P1Bd2uG9Cacbl1qMp4VsQ/viewform"
       target="_blank" class="upload-btn">
      üì§ Upload Your Notes ‚Äì Get Free Access
    </a>
  </section>
</main>

<nav class="bottom-nav">
  <a href="#" class="nav-item active">
    üè† <span>Home</span>
  </a>
  <a href="#notes" class="nav-item">
    üìö <span>Notes</span>
  </a>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSfssMV4Ny7hjr5UOaYlmHSr5MAr2P1Bd2uG9Cacbl1qMp4VsQ/viewform"
     target="_blank" class="nav-item center-btn">
    ‚ûï <span>Upload</span>
  </a>
  <a href="#profile" class="nav-item">
    üë§ <span>Profile</span>
  </a>
</nav>

<section id="adminPanel" style="display:none; margin-top:30px; padding:16px; border:1px solid #ddd; border-radius:10px; background:#f9fafb;">
  <h2 style="text-align:center;">üîê Admin Panel</h2>

  <label>Semester:</label>
  <select id="adminSemester">
    <option value="">Select Semester</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
  </select>

  <label>Subject:</label>
  <input id="adminSubject" placeholder="e.g. DSA">


  <label>Material:</label>
  <select id="adminMaterial">
    <option value="notes">Notes</option>
    <option value="pyqs">PYQs</option>
    <option value="syllabus">Syllabus</option>
  </select>

  <label>Drive Link:</label>
  <input id="adminLink" placeholder="Paste Google Drive link here" style="width:100%">

  <button onclick="saveAdminData()" style="margin-top:10px;">üíæ Save Link</button>

  <p id="adminMsg" style="margin-top:10px; color:green;"></p>
</section>


<script>
const data = {
  "1": {
    "Chemistry": {
      notes: "https://drive.google.com/drive/folders/1YkGnUUEm1QwP8A258wwwir4KkKRYVEhQ?usp=drive_link",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "M1": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "English for Communication": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "Basic Electrical & Electronics Engineering ": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
    "Engineering Drawing": {
      notes: "JAVA_NOTES",
      pyqs: "JAVA_PYQS",
      syllabus: "JAVA_SYLLABUS"
    }
  },
  "2": {
    "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
    "java": {
      notes: "JAVA_NOTES",
      pyqs: "JAVA_PYQS",
      syllabus: "JAVA_SYLLABUS"
    }
  },
  "3": {
    "Discrete Mathematics": {
      notes: "https://drive.google.com/drive/folders/1Z8U2IaluGHGV3CkiYlqq5oKK_y1NYFoW?usp=drive_link",
      pyqs: "https://drive.google.com/drive/folders/1WqMEYLj1oeJjo-t0PXgC30gxTb6VYGHa?usp=drive_link",
      syllabus: "https://drive.google.com/drive/folders/M2_SYLLABUS"
    },
    "dsa": {
      notes: "https://drive.google.com/drive/folders/1P2xL4HBrCTkS7M_F5HErfkTHZgqAQQma?usp=drive_link",
      pyqs: "https://drive.google.com/drive/folders/1LDuDsBJ6ONqr9tFUrmHaO8uIwC6-2ZuI?usp=drive_link",
      syllabus: "DSA_SYLLABUS"
    },
    "EEEs": {
      notes: "https://drive.google.com/drive/folders/1ZQ6QoaLmGiZvaIbCaY6LwpcTlxweEqI7?usp=drive_link",
      pyqs: "https://drive.google.com/drive/folders/12FtuXxGJKQJXWsXGVfb2uVSuelyLzzLh?usp=drive_link",
      syllabus: "DBMS_SYLLABUS"
    },
    "Digital System": {
      notes: "https://drive.google.com/drive/folders/10lYhVryrHRTU7wcHVhlNzkIR9XKvjim0?usp=drive_link",
      pyqs: "https://drive.google.com/drive/folders/1LaTLi_9iU6tPJKV6oLe9J97c8Mpo8KT2?usp=drive_link",
      syllabus: "CN_SYLLABUS"
    },
    "OOPM": {
      notes: "https://drive.google.com/drive/folders/16ZVPO38l6EVrp_lesQWkfxIOvgXmKb4m?usp=drive_link",
      pyqs: "https://drive.google.com/drive/folders/1KHBfLUKwdBMg8qyxY0qXUITU8fQljDlb?usp=drive_link",
      syllabus: "CN_SYLLABUS"
    }
  },
  "4": {
    "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
        "cn": {
      notes: "CN_NOTES",
      pyqs: "CN_PYQS",
      syllabus: "CN_SYLLABUS"
    },
    "java": {
      notes: "JAVA_NOTES",
      pyqs: "JAVA_PYQS",
      syllabus: "JAVA_SYLLABUS"
    }
  }
};

const semesterSelect = document.getElementById("semester");
const subjectSelect = document.getElementById("subject");

semesterSelect.addEventListener("change", loadSubjects);


function getBadges(materials) {
  const badges = [];

  if (materials.notes && materials.notes.startsWith("http"))
    badges.push("üü¢ Notes");

  if (materials.pyqs && materials.pyqs.startsWith("http"))
    badges.push("üü° PYQs");

  if (badges.length === 0)
    badges.push("üî¥ Coming Soon");

  return " ‚Äî " + badges.join(" | ");
}

//------------ LOAD SUBJECT BY SEMESTER-----
function loadSubjects() {
  subjectSelect.innerHTML = '<option value="">Select Subject</option>';

  document.getElementsByID("chipContainer").innerHTML="";

  const semester = semesterSelect.value;
  const showAvailableOnly = document.getElementById("availableOnly").checked;

  if (!semester || !data[semester]) return;

  Object.keys(data[semester]).forEach(subject => {
    const materials = data[semester][subject];

    let hasAny = false;
    for (let key in materials) {
      if (materials[key] && materials[key].startsWith("http")) {
        hasAny = true;
        break;
      }
    }

    if (showAvailableOnly && !hasAny) return;

    const option = document.createElement("option");
    option.value = subject;
    option.textContent = subject + getBadges(materials);
    subjectSelect.appendChild(option);
  });
}

semesterSelect.addEventListener("change", loadSubjects);
document.getElementById("availableOnly").addEventListener("change", loadSubjects);


///-------- Chips --------

function renderChips(materials) {
  const chipBox = document.getElementById("chipContainer");
  chipBox.innerHTML = "";

  let added = false;

  if (materials.notes && materials.notes.startsWith("http")) {
    const chip = document.createElement("div");
    chip.className = "status-chip chip-notes";
    chip.innerHTML = "‚úÖ Notes Available";
    chipBox.appendChild(chip);
    added = true;
  }

  if (materials.pyqs && materials.pyqs.startsWith("http")) {
    const chip = document.createElement("div");
    chip.className = "status-chip chip-pyqs";
    chip.innerHTML = "üìÑ PYQs Available";
    chipBox.appendChild(chip);
    added = true;
  }

  if (!added) {
    const chip = document.createElement("div");
    chip.className = "status-chip chip-coming";
    chip.innerHTML = "‚è≥ Coming Soon";
    chipBox.appendChild(chip);
  }
}

// Show chips when subject changes
subjectSelect.addEventListener("change", () => {
  const semester = semesterSelect.value;
  const subject = subjectSelect.value;

  if (!semester || !subject) {
    document.getElementById("chipContainer").innerHTML = "";
    return;
  }

  const materials = data[semester][subject];
  renderChips(materials);
});


//--------- Open study Pack
function openStudyPack() {
  const semester = semesterSelect.value;
  const subject = subjectSelect.value;
  const material = document.getElementById("material").value;

  if (!semester || !subject || !material) {
    alert("Please select Semester, Subject & Material");
    return;
  }

  const pack = data[semester]?.[subject]?.[material];

  if (!pack) {
    alert("This material is not uploaded yet.");
    return;
  }

  //---------FAVORITES BUTTON________
document.getElementById("favBtn").addEventListener("click", () => {
  const subject = subjectSelect.value;
  if (!subject) {
    alert("Select a subject first!");
    return;
  }

  let favs = JSON.parse(localStorage.getItem("favourites") || "[]");

  if (!favs.includes(subject)) {
    favs.push(subject);
    localStorage.setItem("favourites", JSON.stringify(favs));
    updateDashboard();
  } else {
    alert("Already in favourites!");
  }
});

// -------- DASHBOARD LOGIC --------
function updateDashboard() {
  const name = localStorage.getItem("studentName");
  const email = localStorage.getItem("studentEmail");

  if (!name) return;

  document.getElementById("dashboard").style.display = "block";
  document.getElementById("dashName").textContent = name;

  const sem = semesterSelect.value || "Not selected";
  document.getElementById("dashSem").textContent = sem;

  const favs = JSON.parse(localStorage.getItem("favourites") || "[]");
  const favBox = document.getElementById("favList");
  favBox.innerHTML = "";

  favs.forEach(sub => {
    const chip = document.createElement("div");
    chip.textContent = "‚≠ê " + sub;
    chip.style.cssText =
      "background:#e0f2fe;padding:6px 10px;border-radius:999px;font-size:0.85rem;";
    favBox.appendChild(chip);
  });

  const last = localStorage.getItem("lastDownload") || "None";
  document.getElementById("lastDownload").textContent = last;
}


  // ---- NEW: Save last download ----
  localStorage.setItem(
    "lastDownload",
    `${subject} ‚Üí ${material.toUpperCase()}`
  );

  window.open(pack, "_blank");

  // Update dashboard instantly
  updateDashboard();
}

function updateDashboard() {
  const name = localStorage.getItem("studentName");
  if (!name) return;

  // Show dashboard if visible
  const dash = document.getElementById("dashboard");
  if (dash) dash.style.display = "block";

  document.getElementById("dashName").textContent = name;

  // Semester
  const sem = document.getElementById("semester").value || "Not selected";
  document.getElementById("dashSem").textContent = sem;

  // Favourites
  const favs = JSON.parse(localStorage.getItem("favourites") || "[]");
  const favBox = document.getElementById("favList");
  if (favBox) {
    favBox.innerHTML = "";
    favs.forEach(sub => {
      const chip = document.createElement("div");
      chip.textContent = "‚≠ê " + sub;
      chip.style.cssText = "background:#e0f2fe;padding:6px 10px;border-radius:999px;font-size:0.85rem;";
      favBox.appendChild(chip);
    });
  }

  // Last download
  const last = localStorage.getItem("lastDownload") || "None";
  const lastEl = document.getElementById("lastDownload");
  if (lastEl) lastEl.textContent = last;
}

//-----Google Login------
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userInfo = document.getElementById("userInfo");

function handleCredentialResponse(response) {
  const userObject = JSON.parse(atob(response.credential.split(".")[1]));

  localStorage.setItem("studentName", userObject.name);
  localStorage.setItem("studentEmail", userObject.email);

  showUser();
}

function showUser() {
  const name = localStorage.getItem("studentName");
  const email = localStorage.getItem("studentEmail");

  if (name) {
    loginBtn.style.display = "none";
    userInfo.style.display = "block";
    document.getElementById("userName").textContent = name;
    document.getElementById("userEmail").textContent = email;
  }
}

window.onload = function () {
  google.accounts.id.initialize({
    client_id: "596258765969-gg9u20m1phalc6fhke70ur2mogdnqci9.apps.googleusercontent.com",
    callback: handleCredentialResponse
  });
};

loginBtn.addEventListener("click", () => {
  google.accounts.id.initialize
  google.accounts.id.prompt();
});

logoutBtn.addEventListener("click", () => {
  localStorage.clear();
  location.reload();
});

showUser();


//-------Admin pannel-------------
function checkAdmin() {
  const email = localStorage.getItem("studentEmail");

  // üëá Replace with YOUR Gmail
  if (email === "kori626892@gmail.com") {
    document.getElementById("adminPanel").style.display = "block";
  }
}

function saveAdminData() {
  const sem = document.getElementById("adminSemester").value;
  const sub = document.getElementById("adminSubject").value.trim();
  const mat = document.getElementById("adminMaterial").value;
  const link = document.getElementById("adminLink").value.trim();

  if (!sem || !sub || !link) {
    alert("Fill all fields!");
    return;
  }

  if (!data[sem]) data[sem] = {};

  if (!data[sem][sub]) {
    data[sem][sub] = { notes:"", pyqs:"", syllabus:"" };
  }

  data[sem][sub][mat] = link;

  document.getElementById("adminMsg").textContent =
    `‚úÖ Saved: Sem ${sem} ‚Üí ${sub} ‚Üí ${mat}`;

  loadSubjects(); // refresh dropdown
}


// Override showUser so dashboard loads after login
showUser = function () {
  const name = localStorage.getItem("studentName");
  const email = localStorage.getItem("studentEmail");

  if (name) {
    loginBtn.style.display = "none";
    userInfo.style.display = "block";
    document.getElementById("userName").textContent = name;
    document.getElementById("userEmail").textContent = email;

    checkAdmin();
    updateDashboard();
  }
};

</script>

console.clear();

</body>
</html>
       